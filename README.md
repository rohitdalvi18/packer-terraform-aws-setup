# packer-terraform-aws-setup

## Overview
This project automates infrastructure provisioning using **Packer** and **Terraform**. It includes:
- **Packer**: Creates a custom Amazon Machine Image (AMI) with Docker and SSH access.
- **Terraform**: Provisions a secure AWS environment with a **VPC, Bastion Host, and Private EC2 Instances**.
- **Security Best Practices**: Bastion host for SSH access, private EC2 instances with no public IPs.

---

## Project Structure
```
.
├── packer/
│   ├── amazon-linux.pkr.hcl        # Packer template to build custom AMI
├── terraform/
│   ├── versions.tf                 # Terraform version and provider details
│   ├── variables.tf                # Variables for Terraform setup
│   ├── vpc.tf                      # VPC setup
│   ├── bastion_host.tf             # Bastion host setup
│   ├── private_ec2_instances.tf    # Private EC2 instances setup
│   ├── outputs.tf                  # Terraform outputs
│   ├── providers.tf                # AWS provider configuration
│   ├── terraform.tfvars            # User-defined secret values (ignored in Git)
│   ├── README.md                   # Documentation
└── .gitignore                      # Ignore sensitive files
└── .labsuser.pem                   # Your AWS lab key (ignored in Git)
└── .keypair.pem                    # Your private EC2 SSH key (ignored in Git)
```

---

## Prerequisites
Ensure you have the following installed:
- **Terraform** (>= 1.3.0)
- **Packer** (latest version)
- **AWS CLI** (configured with appropriate credentials)
- **SSH Key Pair** for Bastion Host and private EC2 instances

---

## Build Custom AMI with Packer

1. Navigate to the **Packer** directory:
   ```sh
   cd packer/
   ```
2. Initialize and Format your Packer configuration
   ```sh
   packer init .
   packer fmt .
   ```
3. Validate the Packer template:
   ```sh
   packer validate .
   ```
3. Build the custom AMI:
   ```sh
   packer build amazon-linux.pkr.hcl
   ```
### Output

1. You should see below output in terminal:

   <img width="720" alt="terminal1" src="https://github.com/user-attachments/assets/d7f81259-4351-498c-96e3-74c9b3ad75ab" />
   <img width="720" alt="terminal2" src="https://github.com/user-attachments/assets/58528ee1-f8e1-4fa8-9d9f-db1508943877" />
   <img width="720" alt="terminal3" src="https://github.com/user-attachments/assets/e168b4e3-16da-4737-bbb7-53e74b17967b" />


2. A temporary keypair is generated by Packer:

<img width="720" alt="keypair" src="https://github.com/user-attachments/assets/779e2721-954b-4b40-831c-414b0a9bee92" />


3. A temporary EC2 instance is launched by Packer to create the AMI:

<img width="720" alt="ec2" src="https://github.com/user-attachments/assets/4a04808d-163c-4328-bf11-557a33071850" />


4. Note the **AMI ID** from the output for use in Terraform:

<img width="720" alt="AMI" src="https://github.com/user-attachments/assets/d1c5dff5-f748-47c5-abaa-80b7e28bf3b1" />


---

